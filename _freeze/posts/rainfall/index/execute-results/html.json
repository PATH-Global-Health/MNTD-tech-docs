{
  "hash": "88c64b69e9aee4d16f9a0bb8a3286552",
  "result": {
    "markdown": "---\ntitle: \"Downloading CHIRPS rainfall data\"\nauthor: \"Will Sheahan, Justin Millar, and Ellen Ferriss\"\ndate: \"1/27/2023\"\ncategories: [rainfall, R, raster]\nimage: \"thumbnail.jpg\"\ntoc: true\nformat:\n  html:\n    code-fold: false\n    code-tools: true\nexecute:\n  warning: false\n  message: false\n---\n\n\n## About CHIRPS\n\nThe Climate Hazards Group InfraRed Precipitation with Station data (CHIRPS) is a quasi-global rainfall dataset spanning 1981 to present. The rainfall data is available as daily, pentadaily (5-day), and monthly raster files at a resolution of 0.05°. This post covers how to obtain CHIRPS data using the `PATHtools` package for projects requiring areal data, e.g., summary data for health districts or regions. It also provides a brief introduction to the [`chirps` R package](https://docs.ropensci.org/chirps/), which downloads data at user-defined points, e.g., health facilities or households.\n\nLearn more about CHIRPS at [UCSB's Climate Hazards Center](https://www.chc.ucsb.edu/data/chirps).\n\n## Areal data\n\nThe `PATHtools` `rainfall()` function allows you to extract estimates of average rainfall across one or more areas saved as project shapefiles. First, install `PATHtools`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"devtools\", repos = \"http://cran.us.r-project.org\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\npackage 'devtools' successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\eferriss\\AppData\\Local\\Temp\\RtmpScGxNO\\downloaded_packages\n```\n:::\n\n```{.r .cell-code}\ndevtools::install_github(\"PATH-Global-Health/PATHtools\")\n```\n:::\n\n\nNext, read in a shapefile of Zambia's provinces from the package and obtain daily rainfall estimates for each polygon (province). Note the arguments for the `daily_rainfall()` function: The **start_date** and **end_date** are the beginning and end boundaries of your time period, and must be supplied in \"YYYY-MM-DD\" format. The shapefile **shp** should be an **sf** object of the POLYGON or MULTIPOLYGON class.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(PATHtools)\n\n#Load shapefile\nshp <- load_shapefile(country = \"Zambia\", admin_level = 1)\n\n#Obtain daily rainfall for 2012-01-01 through 2012-01-31 in WIDE FORMAT\nstart_date <- \"2012-01-01\"\nend_date <- \"2012-01-31\"\nrain_areal <- daily_rainfall(c(start_date, end_date),shp)\n\n#View rainfall data for first 5 days\nrain_areal[,1:9]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 9\n   ADM1         chirps…¹ chirp…² chirp…³ chirp…⁴ chirp…⁵ chirp…⁶ chirp…⁷ chirp…⁸\n   <chr>           <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n 1 Central        17.0    12.5    1.66    0.0755  0.783    1.44   5.06   1.02e+0\n 2 Copperbelt     23.1     6.61   1.59    1.06    4.49     0.312 10.7    4.61e+0\n 3 Eastern        15.3    28.4    5.44    3.35   14.0      4.25   9.81   6.33e+0\n 4 Luapula         2.52    3.81   2.97   16.5     6.14     6.87   7.45   1.23e+1\n 5 Lusaka         17.6     8.10   0.332   0       0        0.863  0.0260 0      \n 6 Muchinga        4.34    8.79   9.76   11.3     9.30     9.05  13.4    3.65e+0\n 7 Northern        0.219   2.43   2.39   19.8    11.1      7.66   7.27   6.27e+0\n 8 Northwestern    7.48    6.93   4.14    1.34    1.33     4.34   2.72   6.17e+0\n 9 Southern       13.2     0.784  0.0663  0       0.0169   1.54   0.0506 1.04e-3\n10 Western         6.81    4.67   0.210   0.634   0        2.49   1.66   7.74e-1\n# … with abbreviated variable names ¹​`chirps_2012-01-01`, ²​`chirps_2012-01-02`,\n#   ³​`chirps_2012-01-03`, ⁴​`chirps_2012-01-04`, ⁵​`chirps_2012-01-05`,\n#   ⁶​`chirps_2012-01-06`, ⁷​`chirps_2012-01-07`, ⁸​`chirps_2012-01-08`\n```\n:::\n:::\n\n\nThe default data format from `daily_rainfall()` is wide. To obtain the data in long format, set the argument **long** equal to TRUE.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Obtain daily rainfall for 2012-01-01 through 2012-01-31 in LONG FORMAT\nrain_areal_long <- daily_rainfall(c(start_date, end_date),shp, long = TRUE)\n\n#View rainfall data for first 5 days in Central Province\nrain_areal_long[1:5,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n  ADM1    date       rainfall\n  <chr>   <date>        <dbl>\n1 Central 2012-01-01  17.0   \n2 Central 2012-01-02  12.5   \n3 Central 2012-01-03   1.66  \n4 Central 2012-01-04   0.0755\n5 Central 2012-01-05   0.783 \n```\n:::\n:::\n\n\nFinally, to obtain CHIRPS rasters, set the argument **output_raster** equal to TRUE.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Obtain daily rainfall rasters for 2012-01-01 through 2012-01-31\nrain_areal_raster <- daily_rainfall(c(start_date, end_date), shp, output_raster = TRUE)\n\n#Plot raster for January 1, 2012\nterra::plot(rain_areal_raster$`chirps_2012-01-01`)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Point data\n\nTo get estimated daily rainfall at specified locations, such as health facilities, we can use the `chirps` package. Here, we'll create a data.frame of points and download their data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"chirps\", repos = \"http://cran.us.r-project.org\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\npackage 'chirps' successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\eferriss\\AppData\\Local\\Temp\\RtmpScGxNO\\downloaded_packages\n```\n:::\n\n```{.r .cell-code}\nlibrary(chirps)\n\n#Create points object\npoints <- data.frame(lon = c(28.287, 28.213, 28.637, 28.446), lat = c(-15.407, -12.802, -12.959, -14.447))\n\n#Obtain daily rainfall for 2012-01-01 through 2012-01-31\nstart_date <- \"2012-01-01\"\nend_date <- \"2012-01-31\"\nrain_point <- get_chirps(points, c(start_date, end_date), server = \"ClimateSERV\")\n\n#View first few rows\nhead(rain_point)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      id   lon    lat       date chirps\n   <int> <dbl>  <dbl>     <date>  <dbl>\n1:     1 28.29 -15.41 2012-01-01  14.62\n2:     1 28.29 -15.41 2012-01-02   7.31\n3:     1 28.29 -15.41 2012-01-03   0.00\n4:     1 28.29 -15.41 2012-01-04   0.00\n5:     1 28.29 -15.41 2012-01-05   0.00\n6:     1 28.29 -15.41 2012-01-06   0.00\n```\n:::\n:::\n\n\n## Aggregating data from daily to monthly\n\nTo get monthly data, we aggregate the above objects.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\n\n#Aggregate areal data to monthly totals\nrain_areal_long_monthly <- rain_areal_long %>%\n  group_by(ADM1, month = floor_date(date, \"month\")) %>%\n  summarise(rainfall = sum(rainfall))\n\nrain_areal_long_monthly\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 3\n# Groups:   ADM1 [10]\n   ADM1         month      rainfall\n   <chr>        <date>        <dbl>\n 1 Central      2012-01-01     253.\n 2 Copperbelt   2012-01-01     325.\n 3 Eastern      2012-01-01     325.\n 4 Luapula      2012-01-01     259.\n 5 Lusaka       2012-01-01     237.\n 6 Muchinga     2012-01-01     265.\n 7 Northern     2012-01-01     219.\n 8 Northwestern 2012-01-01     237.\n 9 Southern     2012-01-01     163.\n10 Western      2012-01-01     172.\n```\n:::\n\n```{.r .cell-code}\n#Aggregate point data to monthly totals\nrain_point_monthly <- rain_point %>%\n  group_by(lon, lat, month = floor_date(date, \"month\")) %>%\n  summarise(chirps = sum(chirps))\n\nrain_point_monthly\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 4\n# Groups:   lon, lat [4]\n    lon   lat month      chirps\n  <dbl> <dbl> <date>      <dbl>\n1  28.2 -12.8 2012-01-01   321.\n2  28.3 -15.4 2012-01-01   214.\n3  28.4 -14.4 2012-01-01   269.\n4  28.6 -13.0 2012-01-01   330.\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}